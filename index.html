<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>币安alpha交易计数器</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* 基础样式 */
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); /* 淡雅渐变背景 */
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            color: #333; /* 默认文字颜色 */
        }

        /* 应用容器 */
        .container {
            background-color: rgba(255, 255, 255, 0.95); /* 半透明白色背景，增加层次感 */
            padding: 35px 40px; /* 增加内边距 */
            border-radius: 16px; /* 更圆润的边角 */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); /* 更柔和、更深的阴影 */
            text-align: center;
            width: 100%;
            max-width: 650px; /* 稍微增加最大宽度 */
            box-sizing: border-box;
            backdrop-filter: blur(10px); /* 毛玻璃效果 (部分浏览器支持) */
        }

        /* 标题样式 */
        h1 {
            color: #1a2b48; /* 深蓝灰色，更稳重 */
            margin-bottom: 30px;
            font-size: 2.5em; /* 稍微增大字体 */
            font-weight: 700; /* 加粗 */
        }

        /* 账户选择按钮容器 */
        .account-selector {
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px; /* 按钮间距 */
        }

        /* 账户按钮样式 */
        .account-selector button, #add-account-btn {
            color: white;
            border: none;
            padding: 12px 22px; /* 调整内边距 */
            border-radius: 10px; /* 更圆润的按钮边角 */
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease; /* 平滑过渡效果 */
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            letter-spacing: 0.5px; /* 增加字母间距 */
        }

        .account-selector button {
            background-color: #5a67d8; /* 柔和的靛蓝色 */
        }

        .account-selector button:hover {
            background-color: #434190; /* 深一点的靛蓝色 */
            transform: translateY(-3px); /* 轻微上浮效果 */
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .account-selector button.active {
            background-color: #38a169; /* 清新的绿色 */
            box-shadow: 0 4px 15px rgba(56, 161, 105, 0.4);
            transform: translateY(0);
        }

        /* 添加账户按钮样式 */
        #add-account-btn {
            background-color: #dd6b20; /* 温暖的橙色 */
            margin-left: 10px; /* 保持与账户按钮的间距 */
        }

        #add-account-btn:hover {
            background-color: #c05621; /* 深橙色 */
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        /* 输入组样式 */
        .input-group, .multiplier-group {
            margin-bottom: 28px;
            text-align: left;
        }

        .input-group label, .multiplier-group label {
            display: block;
            margin-bottom: 10px; /* 标签与输入框间距 */
            color: #4a5568; /* 柔和的灰色 */
            font-size: 1.1em; /* 稍微增大标签字体 */
            font-weight: 500;
        }

        .input-group input[type="number"],
        .input-group input[type="text"],
        .multiplier-group input[type="number"] {
            padding: 14px 18px; /* 调整输入框内边距 */
            border: 1px solid #cbd5e0; /* 更浅的边框颜色 */
            border-radius: 10px; /* 更圆润的输入框边角 */
            width: calc(100% - 38px); /* 考虑内边距和边框后的宽度 */
            font-size: 1.1em;
            color: #2d3748; /* 深灰色文字 */
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: #fdfdfe; /* 非常浅的背景色 */
        }

        .input-group input:focus,
        .multiplier-group input[type="number"]:focus {
            border-color: #5a67d8; /* 焦点时边框颜色与按钮呼应 */
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.2); /* 焦点时外发光效果 */
            outline: none;
        }

        /* 结果显示区域 */
        .display-area {
            margin-top: 30px;
            border-top: 1px solid #e2e8f0; /* 更浅的分隔线 */
            padding-top: 30px;
        }

        .display-area p {
            font-size: 1.5em; /* 增大显示字体 */
            color: #2d3748;
            margin: 15px 0; /* 调整间距 */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .display-area p strong {
            font-weight: 600;
            color: #4a5568; /* 标签文字颜色 */
            margin-right: 15px;
        }

        /* 高亮数值样式 */
        .highlight {
            font-weight: 700; /* 加粗 */
            color: #c53030; /* 强调红色 */
            font-size: 1.6em; /* 突出数值 */
            flex-grow: 1;
            text-align: right;
        }

        /* 说明文字 */
        .instructions {
            margin-top: 35px;
            font-size: 1em; /* 增大说明文字字体 */
            color: #718096; /* 柔和的灰色 */
            line-height: 1.6;
        }

        /* 键盘按键样式 */
        kbd {
            background-color: #edf2f7; /* 浅灰色背景 */
            border-radius: 6px; /* 更圆润 */
            padding: 5px 9px; /* 调整内边距 */
            border: 1px solid #d2d6dc;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; /* 更现代的等宽字体 */
            font-size: 0.95em;
            color: #2d3748;
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.05); /* 轻微阴影 */
        }

        /* 作者信息 */
        .author-credit {
            margin-top: 40px; /* 增加顶部间距 */
            font-size: 0.95em;
            color: #718096;
        }
        .author-credit a {
            color: #5a67d8; /* 与按钮颜色呼应 */
            text-decoration: none;
            font-weight: 600;
        }
        .author-credit a:hover {
            text-decoration: underline;
            color: #434190;
        }

        /* 响应式调整 */
        @media (max-width: 600px) {
            .container {
                padding: 25px 20px; /* 调整小屏幕内边距 */
                margin-top: 20px; /* 顶部留白 */
                margin-bottom: 20px; /* 底部留白 */
            }
            h1 {
                font-size: 2em; /* 调整标题大小 */
            }
            .account-selector button, #add-account-btn {
                padding: 10px 18px;
                font-size: 0.95em;
                width: calc(50% - 6px); /* 小屏幕下按钮两列显示 */
                margin-left: 0; /* 移除添加按钮的左边距 */
            }
            #add-account-btn {
                 width: 100%; /* 添加账户按钮在小屏幕下占满一行 */
                 margin-top: 10px;
            }
            .account-selector {
                gap: 8px; /* 减小按钮间距 */
            }

            .display-area p {
                font-size: 1.3em;
            }
            .highlight {
                font-size: 1.4em;
            }
            .input-group input[type="number"],
            .input-group input[type="text"],
            .multiplier-group input[type="number"] {
                font-size: 1em;
                padding: 12px 15px;
                width: calc(100% - 32px);
            }
            .instructions {
                font-size: 0.9em;
            }
        }
         @media (max-width: 400px) {
            .account-selector button {
                 width: 100%; /* 在非常小的屏幕上，账户按钮也占满一行 */
            }
         }
    </style>
</head>
<body>
    <div class="container">
        <h1>币安alpha交易额计数器</h1>
        <div class="account-selector" id="account-buttons-container">
            </div>
        <button id="add-account-btn">添加新账户</button>

        <div class="input-group">
            <label for="account-name-input">当前账户名称:</label>
            <input type="text" id="account-name-input" placeholder="输入账户名称">
        </div>

        <div class="input-group">
            <label for="transaction-amount">请输入每次交易数量:</label>
            <input type="number" id="transaction-amount" placeholder="例如: 100" value="0" min="0">
        </div>

        <div class="multiplier-group">
            <label for="transaction-multiplier-input">交易额倍数:</label>
            <input type="number" id="transaction-multiplier-input" value="1" min="0.1" step="0.1">
        </div>

        <div class="display-area">
            <p><strong>当前账户:</strong> <span id="current-account-display" class="highlight">N/A</span></p>
            <p><strong>交易笔数:</strong> <span id="transaction-count" class="highlight">0</span></p>
            <p><strong>总交易额:</strong> <span id="total-transaction-value" class="highlight">0.00</span></p>
        </div>

        <p class="instructions">
            按 <kbd>上</kbd> 键增加交易笔数，按 <kbd>下</kbd> 键减少交易笔数。
        </p>

        <p class="author-credit">
            作者: <a href="https://x.com/0xM3tr0" target="_blank" rel="noopener noreferrer">X: @0xM3tr0</a>
        </p>
    </div>

    <script>
        // Get references to DOM elements
        const accountButtonsContainer = document.getElementById('account-buttons-container');
        const addAccountBtn = document.getElementById('add-account-btn');
        const accountNameInput = document.getElementById('account-name-input');
        const transactionAmountInput = document.getElementById('transaction-amount');
        const transactionMultiplierInput = document.getElementById('transaction-multiplier-input');
        const transactionCountDisplay = document.getElementById('transaction-count');
        const totalTransactionValueDisplay = document.getElementById('total-transaction-value');
        const currentAccountDisplay = document.getElementById('current-account-display');

        // Data structure to store all accounts
        let accounts = [];
        let currentAccountId = null;
        let nextAccountId = 0;

        /**
         * Loads the saved state from localStorage.
         */
        function loadState() {
            const savedState = localStorage.getItem('transactionCounterState');
            if (savedState) {
                try {
                    const parsedState = JSON.parse(savedState);
                    if (parsedState.accounts && Array.isArray(parsedState.accounts)) {
                        accounts = parsedState.accounts;
                    } else {
                        accounts = [
                            { id: 'account_0', name: '账户 A', transactionCount: 0, transactionAmount: 0, transactionMultiplier: 1 },
                            { id: 'account_1', name: '账户 B', transactionCount: 0, transactionAmount: 0, transactionMultiplier: 1 }
                        ];
                    }
                    currentAccountId = parsedState.currentAccountId || (accounts.length > 0 ? accounts[0].id : null);
                    nextAccountId = parsedState.nextAccountId || accounts.length;

                    accounts.forEach(account => {
                        if (typeof account.transactionCount === 'undefined') account.transactionCount = 0;
                        if (typeof account.transactionAmount === 'undefined') account.transactionAmount = 0;
                        if (typeof account.name === 'undefined') account.name = `账户 ${account.id.split('_')[1] ? parseInt(account.id.split('_')[1]) + 1 : 'New'}`;
                        
                        if (typeof account.doubleTransaction !== 'undefined') {
                            account.transactionMultiplier = account.doubleTransaction ? 2 : 1;
                            delete account.doubleTransaction;
                        }
                        if (typeof account.transactionMultiplier === 'undefined') account.transactionMultiplier = 1;
                    });

                } catch (e) {
                    console.error("解析localStorage中的状态时出错:", e);
                    accounts = [
                        { id: 'account_0', name: '账户 A', transactionCount: 0, transactionAmount: 0, transactionMultiplier: 1 },
                        { id: 'account_1', name: '账户 B', transactionCount: 0, transactionAmount: 0, transactionMultiplier: 1 }
                    ];
                    currentAccountId = 'account_0';
                    nextAccountId = 2;
                }
            } else {
                accounts = [
                    { id: 'account_0', name: '账户 A', transactionCount: 0, transactionAmount: 0, transactionMultiplier: 1 },
                    { id: 'account_1', name: '账户 B', transactionCount: 0, transactionAmount: 0, transactionMultiplier: 1 }
                ];
                currentAccountId = 'account_0';
                nextAccountId = 2;
            }
        }

        /**
         * Saves the current state to localStorage.
         */
        function saveState() {
            localStorage.setItem('transactionCounterState', JSON.stringify({
                accounts: accounts,
                currentAccountId: currentAccountId,
                nextAccountId: nextAccountId
            }));
        }

        /**
         * Renders account buttons in the UI.
         */
        function renderAccountButtons() {
            accountButtonsContainer.innerHTML = '';
            accounts.forEach(account => {
                const button = document.createElement('button');
                button.id = `btn-${account.id}`;
                button.textContent = account.name;
                button.classList.add('account-button');
                if (account.id === currentAccountId) {
                    button.classList.add('active');
                }
                button.addEventListener('click', () => switchAccount(account.id));
                accountButtonsContainer.appendChild(button);
            });
        }

        /**
         * Updates the UI display based on the current account's data.
         */
        function updateDisplay() {
            const currentAccountData = accounts.find(acc => acc.id === currentAccountId);

            if (!currentAccountData) {
                console.warn("未找到当前账户数据，ID:", currentAccountId); // 使用 warn 级别
                currentAccountDisplay.textContent = "无"; // 更明确的无账户提示
                transactionCountDisplay.textContent = "0";
                totalTransactionValueDisplay.textContent = "0.00";
                accountNameInput.value = "";
                transactionAmountInput.value = "0";
                transactionMultiplierInput.value = "1";
                
                // 禁用输入字段，因为没有活动账户
                accountNameInput.disabled = true;
                transactionAmountInput.disabled = true;
                transactionMultiplierInput.disabled = true;

                if (accounts.length > 0) { // 如果还有其他账户，则切换到第一个
                    switchAccount(accounts[0].id);
                } else {
                    // 如果一个账户都没有，可以考虑提示用户添加账户
                    currentAccountDisplay.textContent = "请添加账户";
                }
                saveState(); // 即使没有当前账户，也保存一下状态（可能 accounts 数组为空）
                return;
            }
            
            // 如果有活动账户，确保输入字段是启用的
            accountNameInput.disabled = false;
            transactionAmountInput.disabled = false;
            transactionMultiplierInput.disabled = false;

            accountNameInput.value = currentAccountData.name;
            currentAccountDisplay.textContent = currentAccountData.name;
            transactionCountDisplay.textContent = currentAccountData.transactionCount;

            let effectiveTransactionAmount = currentAccountData.transactionAmount * currentAccountData.transactionMultiplier;
            const totalValue = currentAccountData.transactionCount * effectiveTransactionAmount;
            totalTransactionValueDisplay.textContent = totalValue.toFixed(2);

            transactionAmountInput.value = currentAccountData.transactionAmount;
            transactionMultiplierInput.value = currentAccountData.transactionMultiplier;
            saveState();
        }

        /**
         * Switches to a different account.
         * @param {string} accountId - The ID of the account to switch to.
         */
        function switchAccount(accountId) {
            currentAccountId = accountId;
            document.querySelectorAll('.account-selector button').forEach(btn => {
                btn.classList.remove('active');
            });
            const newActiveButton = document.getElementById(`btn-${accountId}`);
            if (newActiveButton) {
                newActiveButton.classList.add('active');
            }
            updateDisplay();
        }

        /**
         * Adds a new account.
         */
        function addAccount() {
            const newAccountId = `account_${nextAccountId++}`;
            const newAccount = {
                id: newAccountId,
                name: `新账户 ${nextAccountId}`,
                transactionCount: 0,
                transactionAmount: 0,
                transactionMultiplier: 1
            };
            accounts.push(newAccount);
            renderAccountButtons();
            switchAccount(newAccountId);
        }

        // Event listener for account name input
        accountNameInput.addEventListener('input', (event) => {
            const currentAccountData = accounts.find(acc => acc.id === currentAccountId);
            if (currentAccountData) {
                currentAccountData.name = event.target.value;
                const currentButton = document.getElementById(`btn-${currentAccountId}`);
                if (currentButton) {
                    currentButton.textContent = event.target.value;
                }
                currentAccountDisplay.textContent = event.target.value;
                saveState();
            }
        });

        // Event listener for transaction amount input
        transactionAmountInput.addEventListener('input', (event) => {
            let amount = parseFloat(event.target.value);
            if (isNaN(amount) || amount < 0) {
                amount = 0;
                event.target.value = 0;
            }
            const currentAccountData = accounts.find(acc => acc.id === currentAccountId);
            if (currentAccountData) {
                currentAccountData.transactionAmount = amount;
                updateDisplay();
            }
        });

        // Event listener for transaction multiplier input
        transactionMultiplierInput.addEventListener('input', (event) => {
            let multiplier = parseFloat(event.target.value);
            if (isNaN(multiplier) || multiplier <= 0) { // 乘数不能为0或负数
                multiplier = 1; // 如果输入无效，默认为1
                event.target.value = 1;
            }
            const currentAccountData = accounts.find(acc => acc.id === currentAccountId);
            if (currentAccountData) {
                currentAccountData.transactionMultiplier = multiplier;
                updateDisplay();
            }
        });

        // Global keyboard event listener
        document.addEventListener('keydown', (event) => {
            if (document.activeElement === accountNameInput || 
                document.activeElement === transactionAmountInput ||
                document.activeElement === transactionMultiplierInput) {
                return; // 如果焦点在输入框内，则不响应快捷键
            }

            const currentAccountData = accounts.find(acc => acc.id === currentAccountId);
            if (!currentAccountData) return;

            if (event.key === 'ArrowUp') {
                currentAccountData.transactionCount++;
                updateDisplay();
                event.preventDefault();
            } else if (event.key === 'ArrowDown') {
                if (currentAccountData.transactionCount > 0) {
                    currentAccountData.transactionCount--;
                    updateDisplay();
                }
                event.preventDefault();
            }
        });

        // Event listener for add account button
        addAccountBtn.addEventListener('click', addAccount);

        // Initialize the application
        function initializeApp() {
            loadState();
            renderAccountButtons();
            if (currentAccountId && accounts.find(acc => acc.id === currentAccountId)) {
                updateDisplay();
            } else if (accounts.length > 0) {
                switchAccount(accounts[0].id);
            } else {
                // 如果没有账户，可以主动添加一个，或者仅更新显示（当前行为）
                updateDisplay(); // 更新显示，此时会提示添加账户或禁用输入
                // addAccount(); // 或者，如果希望总是至少有一个账户，则取消此行注释
            }
        }
        
        initializeApp();
    </script>
</body>
</html>
